<!DOCTYPE html>
<html>
<head>
<style>

html, body {
  font-family: system-ui;
  height: 100%;
  display: flex;
  align-items: center;
  justify-content: center;
  flex-flow: column;
  margin: 0;
}

.log2 {
  margin-bottom: -20px;
  margin-top: 20px;
}

canvas {
  pointer-events: none;
}

</style>
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,viewport-fit=cover,shrink-to-fit=no">
</head>
<body ontouchstart>

<div class="log">Allow access to try orientation.<br></div>

<div class="log2"></div>


<script>

const logEl = document.querySelector('.log');

function onLog(args) {
  
  if (logEl.innerHTML.split('<br>').length > 10) {
    
    logEl.innerHTML = '';
    
  }
  
  logEl.innerHTML += '<br>' + args;
  
}

console.log = onLog;
window.onerror = onLog;

</script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/101/three.min.js"></script>
<script src="GenericFuncs.js"></script>
<script src="RotationHelper.js"></script>
<script src="DeviceOrientationController.js"></script>
<script src="MotionHelper.js"></script>
<script src="main.js"></script>
<script src="estimation.js"></script>


<script>

document.documentElement.addEventListener('click', async () => {
  
  //logEl.innerHTML = '<a style="font-size: 90px">➤</a>';

  let motionPermission;
  
  try {
    
    motionPermission = await DeviceMotionEvent.requestPermission();
    
  } catch (err) {
    
    console.log('No orientation access');
    
  }
  
  if (motionPermission !== 'granted') {
    
    console.log('No orientation access');
    
  }

  //OrientationGrantedFlag = true;
  
  //console.log('Got orientation!');

  window.addEventListener('deviceorientation', onDeviceOrientation);
    
    
});

/*
function onDeviceOrientation(e) {
  
  //logEl.textContent = e.alpha + 'deg';
  logEl.style.rotate = e.alpha + 'deg';
  
}
*/

const log2 = document.querySelector('.log2');

function onDeviceOrientation(e) {
  
  //const compassHeading = GetCompassHeading(e.alpha, event.beta, event.gamma);
  
  /*
  if (compassHeading) {
    
    window.dispatchEvent(new CustomEvent('rotation-is-set', {
      detail: {
        compass_reading: compassHeading
      }
    }));
    
  }
  
  */
  const parkPos = {
    lat: 31.335425, 
    lon: 34.896735
  };
  
  const resp = estimation(parkPos,positionGPS);
  
  //logEl.innerHTML = resp.aspect.dy + 'deg, ' + resp.walkDist + 'min';
  
  logEl.innerHTML = '<div style="font-size: 90px;rotate: -90deg">➤</div>';
  //logEl.innerHTML = '<div style="font-size: 90px;rotate:'+ -90deg">➤</div>';
  
  
 // logEl.style.rotate = -resp.aspect.z.toFixed(1) + 'deg'//-resp.aspect.dy + 'deg';
 
  log2.textContent = 'dy:' + resp.aspect.y.toFixed(1) + 'dx:'+resp.aspect.x.toFixed(1)+ 'dz:'+resp.aspect.z.toFixed(1);
  //log2.textContent = 'cmpss: '+(CameraWrapper.rotation.y*180/3.14).toFixed(1);
  //log2.textContent = 'cmpss: '+(CompassHeading).toFixed(1);


}



</script>

</body>
</html>